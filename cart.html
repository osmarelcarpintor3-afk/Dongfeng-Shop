<!doctype html><html><head><meta charset='utf-8'><meta name='viewport' content='width=device-width,initial-scale=1'/><title>Carrito - Glory shop Osmarel</title>
<link rel='stylesheet' href='styles.css'/>
<script src='https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js'></script>
<script src='https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js'></script>
<script src='https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js'></script>
<script src='https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js'></script>
<script src='firebaseConfig.js'></script>
<script src='admin.js'></script>
<script>firebase.initializeApp(firebaseConfig);</script>
</head><body>
<header class='header'><div class='top'><img src='assets/logo.png' class='site-logo' alt='Glory shop Osmarel'><nav class='nav'><a href='index.html'>Inicio</a><a href='catalog.html'>Catálogo</a><a href='market.html'>Buscar tiendas</a><a href='models.html'>Modelos</a><a href='videos.html'>Videos</a><a href='chat.html'>Chat</a><a href='cart.html'>Carrito</a><a href='admin.html'>Admin</a></nav></div></header>
<main class='container'><div class='card'><h2>Carrito</h2><div id='cartList'></div></div>
<div class='card'><p><strong>Precios ocultos — solicitar presupuesto</strong></p><label>Observaciones:</label><textarea id='notes'></textarea><div style='margin-top:8px'><button id='orderBtn' class='btn'>Hacer encargo por WhatsApp</button></div></div>
<script>
firebase.auth().onAuthStateChanged(function(user){ if(!user) window.location.href='login.html'; });
function createWhatsAppLink(adminNumber, user, cartItems, notes){ var lines=[]; lines.push('Encargo desde Sitio:'); lines.push('Cliente: '+(user.email||'')+' (uid:'+ (user.uid||'') +')'); lines.push(''); lines.push('Items:'); cartItems.forEach(function(it,i){ if(it.type==='internal') lines.push((i+1)+') '+(it.name||it.sku)); else lines.push((i+1)+') '+it.link); }); if(notes) lines.push('Notas: '+notes); return 'https://wa.me/'+adminNumber+'?text='+encodeURIComponent(lines.join('\n')); }
document.getElementById('orderBtn').onclick = async function(){ var cart = JSON.parse(localStorage.getItem('cart')||'[]'); if(cart.length===0){alert('Carrito vacío');return;} var notes=document.getElementById('notes').value; var user=firebase.auth().currentUser; if(!user){ if(confirm('Debes iniciar sesión. Ir a login?')) window.location.href='login.html'; return; } var adminNumber = '19052437948'; var link = createWhatsAppLink(adminNumber, user, cart, notes); window.open(link,'_blank'); };
function render(){ var cart=JSON.parse(localStorage.getItem('cart')||'[]'); var el=document.getElementById('cartList'); if(cart.length===0){el.innerHTML='<div class="small">Carrito vacío</div>'; return;} el.innerHTML=''; cart.forEach(function(it,i){ var d=document.createElement('div'); d.className='card'; var html=''; if(it.type==='internal'){ html += '<img src="'+(it.image||'assets/logo.png')+'" style="height:80px;float:left;margin-right:12px"/>'; html += '<strong>'+ (it.name||'') +'</strong><div class="small">SKU: '+(it.sku||'')+'</div>'; } else { html += '<div style="display:flex;gap:12px;align-items:center">'; if(it.image) html += '<img src="'+it.image+'" style="height:80px;object-fit:cover;border-radius:6px"/>'; else html += '<div style="width:80px;height:80px;background:#111;border-radius:6px;display:flex;align-items:center;justify-content:center;color:#777">No img</div>'; html += '<div style="flex:1">'; html += '<a href="'+it.link+'" target="_blank">'+(it.title || it.link)+'</a>'; if(it.title) html += '<div class="small">'+it.title+'</div>'; html += '</div></div>'; } html += '<div style="margin-top:8px"><button data-i="'+i+'" class="btn removeBtn">Eliminar</button></div>'; d.innerHTML = html; el.appendChild(d); }); var buttons = document.querySelectorAll('.removeBtn'); buttons.forEach(function(b){ b.onclick = function(){ var i = parseInt(b.getAttribute('data-i')); var cart = JSON.parse(localStorage.getItem('cart')||'[]'); cart.splice(i,1); localStorage.setItem('cart', JSON.stringify(cart)); render(); }; }); }
render();
</script></main>
<footer class='footer card' style='text-align:center'>Glory shop Osmarel — Encargos de piezas y accesorios para Dongfeng Glory 330s</footer>
<button id='toHomeBtn' onclick="location.href='index.html'">Inicio</button>
</body></html>
